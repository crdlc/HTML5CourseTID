<!DOCTYPE html>

<html>
  <head>
    <meta charset="UTF-8">
    <title>Custom elements</title>
    <script src="mini-templates.js"></script>
  </head>

  <body>
    <x-list id="my-list">
      <template>
        <li id="#id#"><a href="#"><strong>#text#</strong></a></li>
      </template>
    </x-list>

    <template id="x-list-template">
      <section data-type="list">
        <header>List</header>
        <ul>
          <content></content>
        </ul>
      </section>
    </template>
  </body>

  <script>
    var xListProto = Object.create(HTMLElement.prototype);
    Object.defineProperty(xListProto, 'selectedItem', {
      'get': function() {
        return '1'
      }
    });

    Object.defineProperty(xListProto, 'ref', {
      'set': function(data) {
        data.forEach(function(aItem) {
          var container = this.shadowRoot.querySelector('ul');
          Templates.apply(container, aItem);
        });
      }
    });

    xListProto.createdCallback = function() {
      var xhr = new XMLHttpRequest();

      xhr.open('GET', 'lists.css');

      var component = this;

      xhr.onload = function() {
        var shadow = component.createShadowRoot();

        shadow.innerHTML = '<style>' + xhr.responseText + '</style>';

        var listTemplate = document.getElementById('x-list-template');
        var node = document.importNode(listTemplate.content, true);
        shadow.appendChild(node);

        shadow.querySelector('ul').addEventListener('click', function() {
          console.log('clicked!!!');
        });
      }

      xhr.onerror = function() {
        alert('error');
      }

      xhr.send(null);
    };

    var XList = document.registerElement('x-list', {
      prototype: xListProto
    });
  </script>

  <script>
    var dataList = [
      {
        id: '1',
        text: 'Text of element 1'
      },
      {
        id: '2',
        text: 'Text of element 2'
      }
    ];

    document.getElementById('my-list').ref = dataList;
  </script>
</html>
