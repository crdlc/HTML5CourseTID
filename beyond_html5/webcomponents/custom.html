<!DOCTYPE html>

<html>
  <head>
    <meta charset="UTF-8">
    <title>Custom elements</title>
    <script src="mini-templates.js"></script>
  </head>

  <body>
    <x-list id="my-list">
      <template>
        <li id="#id#"><a href="#"><strong>#text#</strong></a></li>
      </template>
    </x-list>

    <template id="x-list-template">
      <link rel="stylesheet" href="lists.css">
      <section data-type="list">
        <header>List</header>
        <ul>
          <content></content>
        </ul>
      </section>
    </template>
  </body>

  <script>
    var xListProto = Object.create(HTMLElement.prototype);

    // Setting the data
    Object.defineProperty(xListProto, 'ref', {
      set: function(data) {
        data.forEach(function(aItem) {
          var container = this.shadowRoot.querySelector('ul');
          Templates.append(container, aItem);
        }, this);
      }
    });

    xListProto.createdCallback = function() {
      var shadow = this.createShadowRoot();

      var listTemplate = document.getElementById('x-list-template');
      var node = document.importNode(listTemplate.content, true);
      shadow.appendChild(node);

      var link = shadow.querySelector('link');
      var component = this;

      if (link) {
        var resource = link.href;
        var xhr = new XMLHttpRequest();

        xhr.open('GET', resource);

        xhr.onload = function() {
          shadow.innerHTML += ('<style>' + xhr.responseText + '</style>');

          shadow.querySelector('ul').addEventListener('click', function(e) {
            component.selectedItem = e.target.id;
          });
        }

        xhr.onerror = function() {
          alert('error');
        }

        xhr.send(null);
      }
    };

    var XList = document.registerElement('x-list', {
      prototype: xListProto
    });
  </script>

  <script>
    var dataList = [
      {
        id: '1',
        text: 'Text of element 1'
      },
      {
        id: '2',
        text: 'Text of element 2'
      }
    ];

    var myList = document.getElementById('my-list');
    myList.ref = dataList;

    myList.addEventListener('click', function(e) {
      console.log('Element clicked: ', e.target.selectedItem);
    });
  </script>
</html>
